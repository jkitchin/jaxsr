# CLI Reference Guide

## Installation

```bash
pip install "jaxsr[cli]"           # CLI support (click)
pip install "jaxsr[cli,excel]"     # CLI + Excel support
pip install "jaxsr[cli,excel,reports]"  # CLI + Excel + Word reports
```

## Commands Overview

| Command | Purpose |
|---------|---------|
| `jaxsr init` | Create a new DOE study |
| `jaxsr design` | Generate experimental design |
| `jaxsr add` | Import experiment results |
| `jaxsr fit` | Fit symbolic regression model |
| `jaxsr suggest` | Suggest next experiments |
| `jaxsr report` | Generate Excel or Word report |
| `jaxsr status` | Show study summary |
| `jaxsr install-skill` | Install Claude Code JAXSR skill |

---

## `jaxsr init`

Create a new DOE study file.

```bash
jaxsr init <name> -f <factor_spec> [-f <factor_spec> ...] [-d <description>] [-o <output>]
```

### Factor Specification Format

- Continuous: `"name:low:high"` — e.g., `"temperature:300:500"`
- Categorical: `"name:level1,level2,..."` — e.g., `"catalyst:Pt,Pd,Rh"`

### Examples

```bash
# Simple 2-factor study
jaxsr init heat_transfer -f "Reynolds:1000:50000" -f "Prandtl:0.7:100"

# 3 factors with description
jaxsr init catalyst_opt \
    -f "temperature:300:500" \
    -f "pressure:1:10" \
    -f "flow_rate:0.1:2.0" \
    -d "Optimize catalyst yield"

# Mixed continuous and categorical
jaxsr init polymer_study \
    -f "temperature:150:250" \
    -f "time:10:60" \
    -f "solvent:water,ethanol,acetone"

# Custom output path
jaxsr init my_study -f "x:0:1" -f "y:0:1" -o experiments/my_study.jaxsr
```

---

## `jaxsr design`

Generate an experimental design for the study.

```bash
jaxsr design <study_file> [-m <method>] [-n <n_points>] [-s <seed>] [--format <fmt>] [-o <output>]
```

### Options

| Option | Default | Description |
|--------|---------|-------------|
| `-m, --method` | `latin_hypercube` | Design method: `latin_hypercube`, `sobol`, `halton`, `grid` |
| `-n, --n-points` | 20 | Number of design points |
| `-s, --seed` | None | Random seed for reproducibility |
| `--format` | `table` | Output format: `table`, `csv`, `xlsx` |
| `-o, --output` | None | Output file path (required for csv/xlsx) |

### Examples

```bash
# Print design as table
jaxsr design study.jaxsr -m latin_hypercube -n 20

# Generate Excel template for lab use
jaxsr design study.jaxsr -n 20 --format xlsx -o lab_template.xlsx

# Sobol sequence with seed
jaxsr design study.jaxsr -m sobol -n 30 -s 42

# Export to CSV
jaxsr design study.jaxsr -n 15 --format csv -o design.csv
```

---

## `jaxsr add`

Import experimental results from Excel or CSV.

```bash
jaxsr add <study_file> <data_file> [--notes <text>] [--skip-validation]
```

### Supported Formats

- **Excel (.xlsx):** Reads the template generated by `jaxsr design --format xlsx`.
  Validates that column names match factor names.
- **CSV (.csv):** Expects columns matching factor names, with the last column as the response.

### Examples

```bash
# Import from Excel template
jaxsr add study.jaxsr completed_experiments.xlsx

# Import from CSV
jaxsr add study.jaxsr results.csv

# With notes
jaxsr add study.jaxsr batch2.xlsx --notes "Repeat runs with new catalyst batch"

# Skip column validation
jaxsr add study.jaxsr data.xlsx --skip-validation
```

---

## `jaxsr fit`

Fit a symbolic regression model to the study data.

```bash
jaxsr fit <study_file> [-t <max_terms>] [--strategy <strategy>] [--criterion <criterion>]
```

### Options

| Option | Default | Description |
|--------|---------|-------------|
| `-t, --max-terms` | 10 | Maximum number of terms in the model |
| `--strategy` | `greedy_forward` | Selection: `greedy_forward`, `greedy_backward`, `exhaustive`, `lasso_path` |
| `--criterion` | `aicc` | Information criterion: `aic`, `aicc`, `bic` |

### Examples

```bash
# Default fit
jaxsr fit study.jaxsr

# Sparse model with BIC
jaxsr fit study.jaxsr --max-terms 5 --criterion bic

# Exhaustive search (small library only)
jaxsr fit study.jaxsr --strategy exhaustive --max-terms 4

# LASSO screening
jaxsr fit study.jaxsr --strategy lasso_path --max-terms 8
```

---

## `jaxsr suggest`

Suggest next experiments based on the fitted model.

```bash
jaxsr suggest <study_file> [-n <n_points>] [--strategy <strategy>] [--format <fmt>]
```

### Options

| Option | Default | Description |
|--------|---------|-------------|
| `-n, --n-points` | 5 | Number of points to suggest |
| `--strategy` | `space_filling` | Strategy: `space_filling`, `uncertainty`, `error`, `leverage`, `gradient` |
| `--format` | `table` | Output: `table`, `csv` |

### Examples

```bash
# Default suggestions
jaxsr suggest study.jaxsr

# Uncertainty-guided (requires fitted model)
jaxsr suggest study.jaxsr -n 3 --strategy uncertainty

# Export as CSV for automation
jaxsr suggest study.jaxsr -n 10 --format csv > next_experiments.csv
```

---

## `jaxsr report`

Generate a formatted report.

```bash
jaxsr report <study_file> -o <output_file>
```

### Supported Formats

- **Excel (.xlsx):** Multi-sheet workbook with summary, coefficients, metrics, and plots.
  Requires `jaxsr[excel]`.
- **Word (.docx):** Formatted document with equations, tables, and figures.
  Requires `jaxsr[reports]`.

### Examples

```bash
# Excel report
jaxsr report study.jaxsr -o report.xlsx

# Word report
jaxsr report study.jaxsr -o report.docx
```

---

## `jaxsr status`

Print a summary of the study's current state.

```bash
jaxsr status <study_file>
```

Shows:
- Study name and description
- Factor definitions and bounds
- Number of observations
- Design completion status
- Fitted model (if any)

### Example

```bash
jaxsr status study.jaxsr
```

---

## `jaxsr install-skill`

Install the JAXSR Claude Code skill for AI-assisted analysis.

```bash
jaxsr install-skill [--target <path>]
```

Copies the JAXSR skill files to your Claude Code skills directory
(`~/.claude/skills/jaxsr/` by default or `.claude/skills/jaxsr/` in the current project).

### Options

| Option | Default | Description |
|--------|---------|-------------|
| `--target` | `.claude/skills/jaxsr` | Target directory for skill installation |

### Example

```bash
# Install to current project
jaxsr install-skill

# Install to home directory (global)
jaxsr install-skill --target ~/.claude/skills/jaxsr
```

---

## Typical CLI Workflow

```bash
# Day 1: Set up
jaxsr init catalyst -f "T:300:500" -f "P:1:10" -f "catalyst:A,B,C"
jaxsr design catalyst.jaxsr -m latin_hypercube -n 20 --format xlsx -o template.xlsx

# Day 2: Import first results
jaxsr add catalyst.jaxsr completed_template.xlsx --notes "Initial batch"
jaxsr fit catalyst.jaxsr --max-terms 5 --criterion bic
jaxsr status catalyst.jaxsr

# Day 3: Adaptive experiments
jaxsr suggest catalyst.jaxsr -n 5 --strategy uncertainty
# ... run suggested experiments ...
jaxsr add catalyst.jaxsr batch2.xlsx --notes "Uncertainty-guided batch"
jaxsr fit catalyst.jaxsr --max-terms 5

# Day 4: Final report
jaxsr report catalyst.jaxsr -o final_report.xlsx
jaxsr report catalyst.jaxsr -o final_report.docx
```

## Error Handling

- **"No observations"** when fitting → Run `jaxsr add` first
- **"Not fitted"** when suggesting → Run `jaxsr fit` first
- **"Not fitted"** when reporting → Run `jaxsr fit` first
- **"Validation error"** when adding → Check column names match factors, or use `--skip-validation`
- **"click not installed"** → Run `pip install jaxsr[cli]`
